#!/bin/bash
# Exploit Testing Framework for Rocky Linux 8.6
# WARNING: Only use on systems you own or have explicit permission to test

set -e

echo "=== Linux Privilege Escalation Exploit Testing Framework ==="
echo "Target System: Rocky Linux 8.6 (Red Hat 8.10 Compatible)"
echo "Kernel: $(uname -r)"
echo "glibc: $(ldd --version | head -1)"
echo "=========================================================="

# Create results directory
mkdir -p /home/rocky/exploit-results
cd /home/rocky/Linux-Privilege-Escalation-Exploits

echo "Available exploit directories:"
ls -la

echo ""
echo "=== Testing Kernel Exploits ==="

# Function to test an exploit safely
test_exploit() {
    local exploit_dir=$1
    local exploit_name=$2
    
    echo "Testing: $exploit_name"
    echo "Directory: $exploit_dir"
    
    if [ -d "$exploit_dir" ]; then
        cd "$exploit_dir"
        
        # Look for common exploit files
        for file in *.c *.sh *.py; do
            if [ -f "$file" ]; then
                echo "  Found: $file"
                
                # Check if it's a C source file
                if [[ "$file" == *.c ]]; then
                    echo "    Attempting to compile: $file"
                    if gcc -o "${file%.c}" "$file" 2>/dev/null; then
                        echo "    ✓ Compilation successful"
                        echo "    Binary created: ${file%.c}"
                    else
                        echo "    ✗ Compilation failed"
                    fi
                fi
            fi
        done
        
        cd ..
    else
        echo "  Directory not found: $exploit_dir"
    fi
    echo ""
}

# Test recent kernel exploits (2018-2021)
echo "Testing recent kernel exploits..."

# Test CVE-2021-4034 (PwnKit)
test_exploit "2021/CVE-2021-4034" "CVE-2021-4034 (PwnKit)"

# Test CVE-2021-3156 (Sudo Heap Overflow)
test_exploit "2021/CVE-2021-3156" "CVE-2021-3156 (Sudo Heap Overflow)"

# Test CVE-2019-7304 (snapd)
test_exploit "2019/CVE-2019-7304" "CVE-2019-7304 (snapd)"

# Test CVE-2018-1000001 (glibc)
test_exploit "2018/CVE-2018-1000001" "CVE-2018-1000001 (glibc)"

echo "=== Testing User Space Exploits ==="

# Test CVE-2017-1000367 (Sudo)
test_exploit "2017/CVE-2017-1000367" "CVE-2017-1000367 (Sudo)"

# Test CVE-2017-7494 (Samba)
test_exploit "2017/CVE-2017-7494" "CVE-2017-7494 (Samba)"

echo "=== System Information for Exploit Selection ==="
echo "Kernel version: $(uname -r)"
echo "Distribution: $(cat /etc/os-release | grep PRETTY_NAME)"
echo "Architecture: $(uname -m)"
echo "Sudo version: $(sudo --version | head -1)"
echo "glibc version: $(ldd --version | head -1)"

echo ""
echo "=== Exploit Testing Complete ==="
echo "Results saved to: /home/rocky/exploit-results/"
echo ""
echo "IMPORTANT REMINDERS:"
echo "1. Only run exploits on systems you own"
echo "2. Use isolated test environments"
echo "3. Never test on production systems"
echo "4. Ensure proper authorization for penetration testing"
